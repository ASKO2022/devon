django:
  image: python:{{PYTHON_VERSION}}
  container_name: {{PROJECT}}-django
  working_dir: /app
  volumes:
    - ../backend:/app
  command: sh -c "pip install -r requirements.txt && python manage.py runserver 0.0.0.0:8000"
  expose:
    - "8000"
  depends_on:
    - db
  labels:
    - "traefik.enable=true"

    # HTTPS-Router (hast du schon)
    - "traefik.http.routers.${PROJECT}.rule=Host(`${PROJECT}.devon.site`)"
    - "traefik.http.routers.${PROJECT}.entrypoints=websecure"
    - "traefik.http.routers.${PROJECT}.tls=true"
    - "traefik.http.services.${PROJECT}.loadbalancer.server.port=8000"
    - "traefik.http.services.${PROJECT}.loadbalancer.server.scheme=http"
    - "traefik.docker.network=devon"

    # HTTP->HTTPS Redirect (zus√§tzlicher Router + Middleware)
    - "traefik.http.routers.${PROJECT}-http.rule=Host(`${PROJECT}.devon.site`)"
    - "traefik.http.routers.${PROJECT}-http.entrypoints=web"
    - "traefik.http.routers.${PROJECT}-http.middlewares=${PROJECT}-https-redirect"
    - "traefik.http.middlewares.${PROJECT}-https-redirect.redirectscheme.scheme=https"
    - "traefik.http.middlewares.${PROJECT}-https-redirect.redirectscheme.permanent=true"

  networks:
    - default
